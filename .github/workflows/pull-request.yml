name: Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  # AI code review on PRs
  ai-review:
    name: AI Code Review
    uses: ./.github/workflows/reusable-ai-review.yml
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

  # Validate that specs exist for feature PRs
  spec-validation:
    name: Spec Validation
    uses: ./.github/workflows/reusable-spec-validation.yml
    with:
      specs-directory: 'specs'
      require-spec-for-features: true

  # Generate PR description from changes
  pr-description:
    name: Generate PR Description
    if: github.event.action == 'opened'
    uses: ./.github/workflows/reusable-ai-pr-description.yml
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
